# ä½¿ç”¨kubeadmå®‰è£…kubernetes_v1.16.2
> å‚è€ƒ æ–‡ç« ä¸ºï¼š https://kuboard.cn/install/install-k8s.html#%E5%88%9D%E5%A7%8B%E5%8C%96-master-%E8%8A%82%E7%82%B9

## ç¬¬ä¸€éƒ¨åˆ† å‰ç½®
### 1.1 é…ç½®è¦æ±‚
å¯¹äº Kubernetes åˆå­¦è€…ï¼Œæ¨èåœ¨é˜¿é‡Œäº‘æˆ–è…¾è®¯äº‘é‡‡è´­å¦‚ä¸‹é…ç½®ï¼šï¼ˆæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå·±çš„è™šæ‹Ÿæœºã€ç§æœ‰äº‘ç­‰æ‚¨æœ€å®¹æ˜“è·å¾—çš„ Linux ç¯å¢ƒï¼‰
- è‡³å°‘2å° 2æ ¸4G çš„æœåŠ¡å™¨
- Cent OS 7.6

### 1.2 å®‰è£…åçš„è½¯ä»¶ç‰ˆæœ¬ä¸º
- Kubernetes v1.16.2
  - calico 3.9
  - nginx-ingress 1.5.5
- Docker 18.09.7

> å¦‚æœè¦å®‰è£… Kubernetes å†å²ç‰ˆæœ¬ï¼Œè¯·å‚è€ƒï¼š
- å®‰è£… Kubernetes v1.16.1 å•MasterèŠ‚ç‚¹
- å®‰è£… Kubernetes v1.16.0 å•MasterèŠ‚ç‚¹
- å®‰è£… Kubernetes v1.15.4 å•MasterèŠ‚ç‚¹
- å®‰è£… Kubernetes v1.15.3 å•MasterèŠ‚ç‚¹
- å®‰è£… Kubernetes v1.15.2 å•MasterèŠ‚ç‚¹
- å®‰è£… Kubernetes v1.15.1 å•MasterèŠ‚ç‚¹

### 1.3 kubeadm æ¦‚è¿°
Kubeadm æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œé€šè¿‡æä¾› kubeadm init å’Œ kubeadm join æ¥ä½œä¸ºåˆ›å»º Kubernetes é›†ç¾¤çš„æœ€ä½³å®è·µâ€œå¿«é€Ÿè·¯å¾„â€ã€‚

**kubeadm æ‰§è¡Œå¿…è¦çš„æ“ä½œæ¥å¯åŠ¨å¹¶è¿è¡Œä¸€ä¸ªæœ€å°å¯è¡Œé›†ç¾¤ã€‚** æŒ‰ç…§è®¾è®¡ï¼Œå®ƒåªå…³å¿ƒå¼•å¯¼ï¼Œè€Œä¸å…³å¿ƒé…ç½®æœºå™¨ã€‚åŒæ ·ï¼Œå®‰è£…å„ç§ä¸åŒçš„æ’ä»¶ï¼Œå¦‚ Kubernetes Dashboardã€ç›‘æ§è§£å†³æ–¹æ¡ˆä»¥åŠäº‘ç‰¹å®šçš„æ’ä»¶ï¼Œ**éƒ½ä¸åœ¨èŒƒå›´ä¹‹å†…**ã€‚

ç›¸åï¼Œæˆ‘ä»¬æœŸæœ›ç”¨æˆ·èƒ½å¤ŸåŸºäº kubeadm æ„å»ºæ›´é«˜çº§åˆ«å’Œæ›´åŠ å®šåˆ¶åŒ–çš„å·¥å…·ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œä½¿ç”¨ kubeadm ä½œä¸ºæ‰€æœ‰éƒ¨ç½²çš„åŸºç¡€ï¼Œå¯ä»¥æ›´å®¹æ˜“åœ°åˆ›å»ºä¸€è‡´çš„é›†ç¾¤ã€‚

### 1.4 æ£€æŸ¥ centos / hostname
```
# åœ¨ master èŠ‚ç‚¹å’Œ worker èŠ‚ç‚¹éƒ½è¦æ‰§è¡Œ
cat /etc/redhat-release

# æ­¤å¤„ hostname çš„è¾“å‡ºå°†ä¼šæ˜¯è¯¥æœºå™¨åœ¨ Kubernetes é›†ç¾¤ä¸­çš„èŠ‚ç‚¹åå­—
# ä¸èƒ½ä½¿ç”¨ localhost ä½œä¸ºèŠ‚ç‚¹çš„åå­—
hostname

# è¯·ä½¿ç”¨ lscpu å‘½ä»¤ï¼Œæ ¸å¯¹ CPU ä¿¡æ¯
# Architecture: x86_64    æœ¬å®‰è£…æ–‡æ¡£ä¸æ”¯æŒ arm æ¶æ„
# CPU(s):       2         CPU å†…æ ¸æ•°é‡ä¸èƒ½ä½äº 2
lscpu
```
æ“ä½œç³»ç»Ÿå…¼å®¹æ€§

| CentOS ç‰ˆæœ¬ | æœ¬æ–‡æ¡£æ˜¯å¦å…¼å®¹ | å¤‡æ³¨                                |
| ----------- | -------------- | ----------------------------------- |
| 7.7         | ğŸ˜„             | å·²éªŒè¯                              |
| 7.6         | ğŸ˜„             | å·²éªŒè¯                              |
| 7.5         | ğŸ˜             | å·²è¯å®ä¼šå‡ºç° kubelet æ— æ³•å¯åŠ¨çš„é—®é¢˜ |
| 7.4         | ğŸ˜             | åŒä¸Š                                |
| 7.3         | ğŸ˜             | åŒä¸Š                                |
| 7.2         | ğŸ˜             | åŒä¸Š                                |


**ä¿®æ”¹ hostname**: å¦‚æœæ‚¨éœ€è¦ä¿®æ”¹ hostnameï¼Œå¯æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼š
```
# ä¿®æ”¹ hostname
hostnamectl set-hostname your-new-host-name
# æŸ¥çœ‹ä¿®æ”¹ç»“æœ
hostnamectl status
# è®¾ç½® hostname è§£æ
echo "127.0.0.1   $(hostname)" >> /etc/hosts
```
### 1.5 æ£€æŸ¥ç½‘ç»œ
åœ¨æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤
```sh
[root@demo-master-a-1 ~]$ ip route show
default via 172.21.0.1 dev eth0
169.254.0.0/16 dev eth0 scope link metric 1002
172.21.0.0/20 dev eth0 proto kernel scope link src 172.21.0.12

[root@demo-master-a-1 ~]$ ip address
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:16:3e:12:a4:1b brd ff:ff:ff:ff:ff:ff
    inet 172.17.216.80/20 brd 172.17.223.255 scope global dynamic eth0
       valid_lft 305741654sec preferred_lft 305741654sec
```
> kubeletä½¿ç”¨çš„IPåœ°å€
> - `ip route show` å‘½ä»¤ä¸­ï¼Œå¯ä»¥çŸ¥é“æœºå™¨çš„é»˜è®¤ç½‘å¡ï¼Œé€šå¸¸æ˜¯ eth0ï¼Œå¦‚ default via 172.21.0.23 dev eth0
> - `ip address` å‘½ä»¤ä¸­ï¼Œå¯æ˜¾ç¤ºé»˜è®¤ç½‘å¡çš„ IP åœ°å€ï¼ŒKubernetes å°†ä½¿ç”¨æ­¤ IP åœ°å€ä¸é›†ç¾¤å†…çš„å…¶ä»–èŠ‚ç‚¹é€šä¿¡ï¼Œå¦‚ 172.17.216.80
> - æ‰€æœ‰èŠ‚ç‚¹ä¸Š Kubernetes æ‰€ä½¿ç”¨çš„ IP åœ°å€å¿…é¡»å¯ä»¥äº’é€šï¼ˆæ— éœ€ NAT æ˜ å°„ã€æ— å®‰å…¨ç»„æˆ–é˜²ç«å¢™éš”ç¦»ï¼‰

### 1.6 å®‰è£… docker / kubelet
è¯·è®¤çœŸæ ¸å¯¹å¦‚ä¸‹é€‰é¡¹ï¼Œ8 ä¸ªéƒ½é€‰ä¸­åæ‰èƒ½æ˜¾ç¤ºå¦‚ä½•å®‰è£…ã€‚

1. æˆ‘çš„ä»»æ„èŠ‚ç‚¹ centos ç‰ˆæœ¬åœ¨å…¼å®¹åˆ—è¡¨ä¸­
2. æˆ‘çš„ä»»æ„èŠ‚ç‚¹ CPU å†…æ ¸æ•°é‡å¤§äºç­‰äº 2
3. æˆ‘çš„ä»»æ„èŠ‚ç‚¹ hostname ä¸æ˜¯ localhostï¼Œä¸”ä¸åŒ…å«ä¸‹åˆ’çº¿ã€å°æ•°ç‚¹ã€å¤§å†™å­—æ¯
4. æˆ‘çš„ä»»æ„èŠ‚ç‚¹éƒ½æœ‰å›ºå®šçš„å†…ç½‘ IP åœ°å€
5. æˆ‘çš„ä»»æ„èŠ‚ç‚¹åªæœ‰ä¸€å—ç½‘å¡ï¼ˆå¯ä»¥åœ¨å®ŒæˆK8Så®‰è£…åå†æ·»åŠ ç½‘å¡ï¼‰
6. å¦‚æœæˆ‘ç›´æ¥ä½¿ç”¨vmwareç­‰åˆ›å»ºè™šæ‹Ÿæœºï¼Œæˆ‘ä½¿ç”¨NATç½‘ç»œï¼Œè€Œä¸æ˜¯æ¡¥æ¥ç½‘ç»œ
7. æˆ‘çš„ä»»æ„èŠ‚ç‚¹ä¸ä¼šç›´æ¥ä½¿ç”¨ docker run æˆ– docker-compose è¿è¡Œå®¹å™¨
8. æˆ‘çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…


ä½¿ç”¨ root èº«ä»½åœ¨æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œå¦‚ä¸‹ä»£ç ï¼Œä»¥å®‰è£…è½¯ä»¶ï¼š
- docker
- nfs-utils
- kubectl / kubeadm / kubelet

##### å¿«é€Ÿå®‰è£…
```
# åœ¨ master èŠ‚ç‚¹å’Œ worker èŠ‚ç‚¹éƒ½è¦æ‰§è¡Œ

curl -sSL https://kuboard.cn/install-script/v1.16.2/install_kubelet.sh | sh
```
##### æ‰‹åŠ¨å®‰è£…
```sh
#!/bin/bash

# åœ¨ master èŠ‚ç‚¹å’Œ worker èŠ‚ç‚¹éƒ½è¦æ‰§è¡Œ

# å®‰è£… docker
# å‚è€ƒæ–‡æ¡£å¦‚ä¸‹
# https://docs.docker.com/install/linux/docker-ce/centos/
# https://docs.docker.com/install/linux/linux-postinstall/

# å¸è½½æ—§ç‰ˆæœ¬
yum remove -y docker \
docker-client \
docker-client-latest \
docker-common \
docker-latest \
docker-latest-logrotate \
docker-logrotate \
docker-selinux \
docker-engine-selinux \
docker-engine

# è®¾ç½® yum repository
yum install -y yum-utils \
device-mapper-persistent-data \
lvm2
yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

# å®‰è£…å¹¶å¯åŠ¨ docker
yum install -y docker-ce-18.09.7 docker-ce-cli-18.09.7 containerd.io
systemctl enable docker
systemctl start docker

# å®‰è£… nfs-utils
# å¿…é¡»å…ˆå®‰è£… nfs-utils æ‰èƒ½æŒ‚è½½ nfs ç½‘ç»œå­˜å‚¨
yum install -y nfs-utils
yum install -y wget

# å…³é—­ é˜²ç«å¢™
systemctl stop firewalld
systemctl disable firewalld

# å…³é—­ SeLinux
setenforce 0
sed -i "s/SELINUX=enforcing/SELINUX=disabled/g" /etc/selinux/config

# å…³é—­ swap
swapoff -a
yes | cp /etc/fstab /etc/fstab_bak
cat /etc/fstab_bak |grep -v swap > /etc/fstab

# ä¿®æ”¹ /etc/sysctl.conf
# å¦‚æœæœ‰é…ç½®ï¼Œåˆ™ä¿®æ”¹
sed -i "s#^net.ipv4.ip_forward.*#net.ipv4.ip_forward=1#g"  /etc/sysctl.conf
sed -i "s#^net.bridge.bridge-nf-call-ip6tables.*#net.bridge.bridge-nf-call-ip6tables=1#g"  /etc/sysctl.conf
sed -i "s#^net.bridge.bridge-nf-call-iptables.*#net.bridge.bridge-nf-call-iptables=1#g"  /etc/sysctl.conf
# å¯èƒ½æ²¡æœ‰ï¼Œè¿½åŠ 
echo "net.ipv4.ip_forward = 1" >> /etc/sysctl.conf
echo "net.bridge.bridge-nf-call-ip6tables = 1" >> /etc/sysctl.conf
echo "net.bridge.bridge-nf-call-iptables = 1" >> /etc/sysctl.conf
# æ‰§è¡Œå‘½ä»¤ä»¥åº”ç”¨
sysctl -p

# é…ç½®K8Sçš„yumæº
cat <<EOF > /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg
       http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF

# å¸è½½æ—§ç‰ˆæœ¬
yum remove -y kubelet kubeadm kubectl

# å®‰è£…kubeletã€kubeadmã€kubectl
yum install -y kubelet-1.16.2 kubeadm-1.16.2 kubectl-1.16.2

# ä¿®æ”¹docker Cgroup Driverä¸ºsystemd
# # å°†/usr/lib/systemd/system/docker.serviceæ–‡ä»¶ä¸­çš„è¿™ä¸€è¡Œ ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock
# # ä¿®æ”¹ä¸º ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --exec-opt native.cgroupdriver=systemd
# å¦‚æœä¸ä¿®æ”¹ï¼Œåœ¨æ·»åŠ  worker èŠ‚ç‚¹æ—¶å¯èƒ½ä¼šç¢°åˆ°å¦‚ä¸‹é”™è¯¯
# [WARNING IsDockerSystemdCheck]: detected "cgroupfs" as the Docker cgroup driver. The recommended driver is "systemd".
# Please follow the guide at https://kubernetes.io/docs/setup/cri/
sed -i "s#^ExecStart=/usr/bin/dockerd.*#ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --exec-opt native.cgroupdriver=systemd#g" /usr/lib/systemd/system/docker.service

# è®¾ç½® docker é•œåƒï¼Œæé«˜ docker é•œåƒä¸‹è½½é€Ÿåº¦å’Œç¨³å®šæ€§
# å¦‚æœæ‚¨è®¿é—® https://hub.docker.io é€Ÿåº¦éå¸¸ç¨³å®šï¼Œäº¦å¯ä»¥è·³è¿‡è¿™ä¸ªæ­¥éª¤
curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://f1361db2.m.daocloud.io

# é‡å¯ dockerï¼Œå¹¶å¯åŠ¨ kubelet
systemctl daemon-reload
systemctl restart docker
systemctl enable kubelet && systemctl start kubelet

docker version
```
## ç¬¬äºŒéƒ¨åˆ† åˆå§‹åŒ– master èŠ‚ç‚¹
> TIP
> - ä»¥ root èº«ä»½åœ¨ demo-master-a-1 æœºå™¨ä¸Šæ‰§è¡Œ
> - åˆå§‹åŒ– master èŠ‚ç‚¹æ—¶ï¼Œå¦‚æœå› ä¸ºä¸­é—´æŸäº›æ­¥éª¤çš„é…ç½®å‡ºé”™ï¼Œæƒ³è¦é‡æ–°åˆå§‹åŒ– master èŠ‚ç‚¹ï¼Œè¯·å…ˆæ‰§è¡Œ `kubeadm reset` æ“ä½œ

> å…³äºåˆå§‹åŒ–æ—¶ç”¨åˆ°çš„ç¯å¢ƒå˜é‡
> - `APISERVER_NAME` ä¸èƒ½æ˜¯ master çš„ hostname
> - `APISERVER_NAME` å¿…é¡»å…¨ä¸ºå°å†™å­—æ¯ã€æ•°å­—ã€å°æ•°ç‚¹ï¼Œä¸èƒ½åŒ…å«å‡å·
> - `POD_SUBNET` æ‰€ä½¿ç”¨çš„ç½‘æ®µä¸èƒ½ä¸ masterèŠ‚ç‚¹/workerèŠ‚ç‚¹ æ‰€åœ¨çš„ç½‘æ®µé‡å ã€‚è¯¥å­—æ®µçš„å–å€¼ä¸ºä¸€ä¸ª CIDR å€¼ï¼Œå¦‚æœæ‚¨å¯¹ CIDR è¿™ä¸ªæ¦‚å¿µè¿˜ä¸ç†Ÿæ‚‰ï¼Œè¯·ä»ç„¶æ‰§è¡Œ `export POD_SUBNET=10.100.0.1/161` å‘½ä»¤ï¼Œä¸åšä¿®æ”¹

#### å¿«é€Ÿåˆå§‹åŒ–
```sh
# åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ
# æ›¿æ¢ x.x.x.x ä¸º master èŠ‚ç‚¹å®é™… IPï¼ˆè¯·ä½¿ç”¨å†…ç½‘ IPï¼‰
# export å‘½ä»¤åªåœ¨å½“å‰ shell ä¼šè¯ä¸­æœ‰æ•ˆï¼Œå¼€å¯æ–°çš„ shell çª—å£åï¼Œå¦‚æœè¦ç»§ç»­å®‰è£…è¿‡ç¨‹ï¼Œè¯·é‡æ–°æ‰§è¡Œæ­¤å¤„çš„ export å‘½ä»¤
export MASTER_IP=x.x.x.x
# æ›¿æ¢ apiserver.demo ä¸º æ‚¨æƒ³è¦çš„ dnsName
export APISERVER_NAME=apiserver.demo
# Kubernetes å®¹å™¨ç»„æ‰€åœ¨çš„ç½‘æ®µï¼Œè¯¥ç½‘æ®µå®‰è£…å®Œæˆåï¼Œç”± kubernetes åˆ›å»ºï¼Œäº‹å…ˆå¹¶ä¸å­˜åœ¨äºæ‚¨çš„ç‰©ç†ç½‘ç»œä¸­
export POD_SUBNET=10.100.0.1/16
echo "${MASTER_IP}    ${APISERVER_NAME}" >> /etc/hosts

curl -sSL https://kuboard.cn/install-script/v1.16.2/init_master.sh | sh
```
#### æ‰‹åŠ¨åˆå§‹åŒ–
```sh
# åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ
# æ›¿æ¢ x.x.x.x ä¸º master èŠ‚ç‚¹å®é™… IPï¼ˆè¯·ä½¿ç”¨å†…ç½‘ IPï¼‰
# export å‘½ä»¤åªåœ¨å½“å‰ shell ä¼šè¯ä¸­æœ‰æ•ˆï¼Œå¼€å¯æ–°çš„ shell çª—å£åï¼Œå¦‚æœè¦ç»§ç»­å®‰è£…è¿‡ç¨‹ï¼Œè¯·é‡æ–°æ‰§è¡Œæ­¤å¤„çš„ export å‘½ä»¤
export MASTER_IP=x.x.x.x
# æ›¿æ¢ apiserver.demo ä¸º æ‚¨æƒ³è¦çš„ dnsName
export APISERVER_NAME=apiserver.demo
# Kubernetes å®¹å™¨ç»„æ‰€åœ¨çš„ç½‘æ®µï¼Œè¯¥ç½‘æ®µå®‰è£…å®Œæˆåï¼Œç”± kubernetes åˆ›å»ºï¼Œäº‹å…ˆå¹¶ä¸å­˜åœ¨äºæ‚¨çš„ç‰©ç†ç½‘ç»œä¸­
export POD_SUBNET=10.100.0.1/16
echo "${MASTER_IP}    ${APISERVER_NAME}" >> /etc/hosts
```
```sh
#!/bin/bash

# åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ

# è„šæœ¬å‡ºé”™æ—¶ç»ˆæ­¢æ‰§è¡Œ
set -e

# æŸ¥çœ‹å®Œæ•´é…ç½®é€‰é¡¹ https://godoc.org/k8s.io/kubernetes/cmd/kubeadm/app/apis/kubeadm/v1beta2
rm -f ./kubeadm-config.yaml
cat <<EOF > ./kubeadm-config.yaml
apiVersion: kubeadm.k8s.io/v1beta2
kind: ClusterConfiguration
kubernetesVersion: v1.16.2
imageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers
controlPlaneEndpoint: "${APISERVER_NAME}:6443"
networking:
  serviceSubnet: "10.96.0.0/16"
  podSubnet: "${POD_SUBNET}"
  dnsDomain: "cluster.local"
EOF

# kubeadm init
# æ ¹æ®æ‚¨æœåŠ¡å™¨ç½‘é€Ÿçš„æƒ…å†µï¼Œæ‚¨éœ€è¦ç­‰å€™ 3 - 10 åˆ†é’Ÿ
kubeadm init --config=kubeadm-config.yaml --upload-certs

# é…ç½® kubectl
rm -rf /root/.kube/
mkdir /root/.kube/
cp -i /etc/kubernetes/admin.conf /root/.kube/config

# å®‰è£… calico ç½‘ç»œæ’ä»¶
# å‚è€ƒæ–‡æ¡£ https://docs.projectcalico.org/v3.9/getting-started/kubernetes/
rm -f calico-3.9.2.yaml
wget https://kuboard.cn/install-script/calico/calico-3.9.2.yaml
sed -i "s#192\.168\.0\.0/16#${POD_SUBNET}#" calico-3.9.2.yaml
kubectl apply -f calico-3.9.2.yaml
```
#### æ³¨æ„äº‹é¡¹ï¼š
- è¯·ç¡®ä¿æ‚¨ä½¿ç”¨ root ç”¨æˆ·æ‰§è¡Œåˆå§‹åŒ–å‘½ä»¤
- ä¸èƒ½ä¸‹è½½ kubernetes çš„ docker é•œåƒ
  - å®‰è£…æ–‡æ¡£ä¸­ï¼Œé»˜è®¤ä½¿ç”¨é˜¿é‡Œäº‘çš„ docker é•œåƒä»“åº“ï¼Œç„¶è€Œï¼Œæœ‰æ—¶å€™ï¼Œè¯¥é•œåƒä¼šç½¢å·¥
  - å¦‚ç¢°åˆ°ä¸èƒ½ä¸‹è½½ docker é•œåƒçš„æƒ…å†µï¼Œè¯·å°è¯•æ‰‹å·¥åˆå§‹åŒ–ï¼Œå¹¶ä¿®æ”¹æ‰‹å·¥åˆå§‹åŒ–è„šæœ¬é‡Œçš„ç¬¬22è¡Œï¼ˆæ–‡æ¡£ä¸­å·²é«˜äº®ï¼‰ä¸ºï¼š
    ```
    imageRepository: gcr.azk8s.cn/google-containers
    ```
- æ£€æŸ¥ç¯å¢ƒå˜é‡ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤
  ```
  echo MASTER_IP=${MASTER_IP} && echo APISERVER_NAME=${APISERVER_NAME} && echo POD_SUBNET=${POD_SUBNET}
  ```
  è¯·éªŒè¯å¦‚ä¸‹å‡ ç‚¹ï¼š
    - ç¯å¢ƒå˜é‡ MASTER_IP çš„å€¼åº”è¯¥ä¸º master èŠ‚ç‚¹çš„ å†…ç½‘IPï¼Œå¦‚æœä¸æ˜¯ï¼Œè¯·é‡æ–° export
    - APISERVER_NAME ä¸èƒ½æ˜¯ master çš„ hostname
    - APISERVER_NAME å¿…é¡»å…¨ä¸ºå°å†™å­—æ¯ã€æ•°å­—ã€å°æ•°ç‚¹ï¼Œä¸èƒ½åŒ…å«å‡å·
    - POD_SUBNET æ‰€ä½¿ç”¨çš„ç½‘æ®µä¸èƒ½ä¸ masterèŠ‚ç‚¹/workerèŠ‚ç‚¹ æ‰€åœ¨çš„ç½‘æ®µé‡å ã€‚è¯¥å­—æ®µçš„å–å€¼ä¸ºä¸€ä¸ª CIDR å€¼ï¼Œå¦‚æœæ‚¨å¯¹ CIDR è¿™ä¸ªæ¦‚å¿µè¿˜ä¸ç†Ÿæ‚‰ï¼Œè¯·ä»ç„¶æ‰§è¡Œ export POD_SUBNET=10.100.0.1/16 å‘½ä»¤ï¼Œä¸åšä¿®æ”¹
- é‡æ–°åˆå§‹åŒ– master èŠ‚ç‚¹å‰ï¼Œè¯·å…ˆæ‰§è¡Œ `kubeadm reset -f` æ“ä½œ

#### æ£€æŸ¥master åˆå§‹åŒ–ç»“æœ
```sh
# åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ

# æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œç­‰å¾… 3-10 åˆ†é’Ÿï¼Œç›´åˆ°æ‰€æœ‰çš„å®¹å™¨ç»„å¤„äº Running çŠ¶æ€
watch kubectl get pod -n kube-system -o wide

# æŸ¥çœ‹ master èŠ‚ç‚¹åˆå§‹åŒ–ç»“æœ
kubectl get nodes -o wide
```
## ç¬¬ä¸‰éƒ¨åˆ† åˆå§‹åŒ– workerèŠ‚ç‚¹
#### è·å¾— joinå‘½ä»¤å‚æ•°
åœ¨ master èŠ‚ç‚¹ä¸Šæ‰§è¡Œ
```sh
# åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ
kubeadm token create --print-join-command
```
å¯è·å–kubeadm join å‘½ä»¤åŠå‚æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤º
```sh
# kubeadm token create å‘½ä»¤çš„è¾“å‡º
kubeadm join apiserver.demo:6443 --token mpfjma.4vjjg8flqihor4vt     --discovery-token-ca-cert-hash sha256:6f7a8e40a810323672de5eee6f4d19aa2dbdb38411845a1bf5dd63485c43d303
```
> #### æœ‰æ•ˆæ—¶é—´
> è¯¥ token çš„æœ‰æ•ˆæ—¶é—´ä¸º 2 ä¸ªå°æ—¶ï¼Œ2å°æ—¶å†…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ­¤ token åˆå§‹åŒ–ä»»æ„æ•°é‡çš„ worker èŠ‚ç‚¹


### 3.1 åˆå§‹åŒ–worker
é’ˆå¯¹æ‰€æœ‰çš„ worker èŠ‚ç‚¹æ‰§è¡Œ
```sh
# åªåœ¨ worker èŠ‚ç‚¹æ‰§è¡Œ
# æ›¿æ¢ x.x.x.x ä¸º master èŠ‚ç‚¹å®é™… IPï¼ˆè¯·ä½¿ç”¨å†…ç½‘ IPï¼‰
export MASTER_IP=x.x.x.x
# æ›¿æ¢ apiserver.demo ä¸ºåˆå§‹åŒ– master èŠ‚ç‚¹æ—¶æ‰€ä½¿ç”¨çš„ APISERVER_NAME
export APISERVER_NAME=apiserver.demo
echo "${MASTER_IP}    ${APISERVER_NAME}" >> /etc/hosts

# æ›¿æ¢ä¸º master èŠ‚ç‚¹ä¸Š kubeadm token create å‘½ä»¤çš„è¾“å‡º
kubeadm join apiserver.demo:6443 --token mpfjma.4vjjg8flqihor4vt     --discovery-token-ca-cert-hash sha256:6f7a8e40a810323672de5eee6f4d19aa2dbdb38411845a1bf5dd63485c43d303
```
#### æ³¨æ„äº‹é¡¹ï¼š
#### worker èŠ‚ç‚¹ä¸èƒ½è®¿é—® apiserver
åœ¨workerèŠ‚ç‚¹æ‰§è¡Œä»¥ä¸‹è¯­å¥å¯éªŒè¯workerèŠ‚ç‚¹æ˜¯å¦èƒ½è®¿é—® apiserver
```
curl -ik https://apiserver.demo:6443
```
å¦‚æœä¸èƒ½ï¼Œè¯·åœ¨ master èŠ‚ç‚¹ä¸ŠéªŒè¯
```
curl -ik https://localhost:6443
```
æ­£å¸¸è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š
```
HTTP/1.1 403 Forbidden
Cache-Control: no-cache, private
Content-Type: application/json
X-Content-Type-Options: nosniff
Date: Fri, 15 Nov 2019 04:34:40 GMT
Content-Length: 233

{
  "kind": "Status",
  "apiVersion": "v1",
  "metadata": {
...
```
> å¯èƒ½åŸå› 
- å¦‚æœ master èŠ‚ç‚¹èƒ½å¤Ÿè®¿é—® apiserverã€è€Œ worker èŠ‚ç‚¹ä¸èƒ½ï¼Œåˆ™è¯·æ£€æŸ¥è‡ªå·±çš„ç½‘ç»œè®¾ç½®
- /etc/hosts æ˜¯å¦æ­£ç¡®è®¾ç½®ï¼Ÿ

##### worker èŠ‚ç‚¹é»˜è®¤ç½‘å¡
- Kubeletä½¿ç”¨çš„ IP åœ°å€ ä¸ master èŠ‚ç‚¹å¯äº’é€šï¼ˆæ— éœ€ NAT æ˜ å°„ï¼‰ï¼Œä¸”æ²¡æœ‰é˜²ç«å¢™ã€å®‰å…¨ç»„éš”ç¦»
  - å¦‚æœä½ ä½¿ç”¨ vmware æˆ– virtualbox åˆ›å»ºè™šæ‹Ÿæœºç”¨äº K8S å­¦ä¹ ï¼Œå¯ä»¥å°è¯• NAT æ¨¡å¼çš„ç½‘ç»œï¼Œè€Œä¸æ˜¯æ¡¥æ¥æ¨¡å¼çš„ç½‘ç»œ

###### ç§»é™¤workerèŠ‚ç‚¹å¹¶é‡è¯•
> WARNING
- æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ‚¨æ— éœ€ç§»é™¤ worker èŠ‚ç‚¹ï¼Œå¦‚æœæ·»åŠ åˆ°é›†ç¾¤å‡ºé”™ï¼Œæ‚¨å¯ä»¥ç§»é™¤ worker èŠ‚ç‚¹ï¼Œå†é‡æ–°å°è¯•æ·»åŠ 

åœ¨å‡†å¤‡ç§»é™¤çš„ worker èŠ‚ç‚¹ä¸Šæ‰§è¡Œ
```
# åªåœ¨ worker èŠ‚ç‚¹æ‰§è¡Œ
kubeadm reset -f
```
åœ¨ master èŠ‚ç‚¹ demo-master-a-1 ä¸Šæ‰§è¡Œ
```
# åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ
kubectl get nodes -o wide
```
å¦‚æœåˆ—è¡¨ä¸­æ²¡æœ‰æ‚¨è¦ç§»é™¤çš„èŠ‚ç‚¹ï¼Œåˆ™å¿½ç•¥ä¸‹ä¸€ä¸ªæ­¥éª¤
```
# åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ
kubectl delete node demo-worker-x-x
```
> TIP
- å°† demo-worker-x-x æ›¿æ¢ä¸ºè¦ç§»é™¤çš„ worker èŠ‚ç‚¹çš„åå­—
- worker èŠ‚ç‚¹çš„åå­—å¯ä»¥é€šè¿‡åœ¨èŠ‚ç‚¹ demo-master-a-1 ä¸Šæ‰§è¡Œ kubectl get nodes å‘½ä»¤è·å¾—

#### æ£€æŸ¥åˆå§‹åŒ–ç»“æœ
åœ¨ master èŠ‚ç‚¹ä¸Šæ‰§è¡Œ
```sh
# åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ
kubectl get nodes -o wide
```
è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š
```sh
[root@demo-master-a-1 ~]# kubectl get nodes
NAME     STATUS   ROLES    AGE     VERSION
demo-master-a-1   Ready    master   5m3s    v1.16.2
demo-worker-a-1   Ready    <none>   2m26s   v1.16.2
demo-worker-a-2   Ready    <none>   3m56s   v1.16.2
```
### 3.2 ç§»é™¤ work èŠ‚ç‚¹
> #### WARNING
> æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ‚¨æ— éœ€ç§»é™¤ worker èŠ‚ç‚¹ï¼Œå¦‚æœæ·»åŠ åˆ°é›†ç¾¤å‡ºé”™ï¼Œæ‚¨å¯ä»¥ç§»é™¤ worker èŠ‚ç‚¹ï¼Œå†é‡æ–°å°è¯•æ·»åŠ 

åœ¨å‡†å¤‡ç§»é™¤çš„ worker èŠ‚ç‚¹ä¸Šæ‰§è¡Œ
```sh
# åªåœ¨ worker èŠ‚ç‚¹æ‰§è¡Œ
kubeadm reset
```
åœ¨ master èŠ‚ç‚¹ demo-master-a-1 ä¸Šæ‰§è¡Œ

# åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ
```sh
kubectl delete node demo-worker-x-x
```
> #### TIP
> å°† demo-worker-x-x æ›¿æ¢ä¸ºè¦ç§»é™¤çš„ worker èŠ‚ç‚¹çš„åå­—
> worker èŠ‚ç‚¹çš„åå­—å¯ä»¥é€šè¿‡åœ¨èŠ‚ç‚¹ demo-master-a-1 ä¸Šæ‰§è¡Œ kubectl get nodes å‘½ä»¤è·å¾—

## ç¬¬å››éƒ¨åˆ† å®‰è£… Ingress Controller
åœ¨ master èŠ‚ç‚¹ä¸Šæ‰§è¡Œ
#### å¿«é€Ÿå®‰è£…
```sh
# åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ
kubectl apply -f https://kuboard.cn/install-script/v1.16.2/nginx-ingress.yaml
```
#### å¸è½½ Ingress Controller
```sh
# åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ
kubectl delete -f https://kuboard.cn/install-script/v1.16.2/nginx-ingress.yaml
```
#### yamlæ–‡ä»¶
```yaml
# å¦‚æœæ‰“ç®—ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œè¯·å‚è€ƒ https://github.com/nginxinc/kubernetes-ingress/blob/v1.5.5/docs/installation.md å¹¶æ ¹æ®æ‚¨è‡ªå·±çš„æƒ…å†µåšè¿›ä¸€æ­¥å®šåˆ¶

apiVersion: v1
kind: Namespace
metadata:
  name: nginx-ingress

---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: nginx-ingress
  namespace: nginx-ingress

---
apiVersion: v1
kind: Secret
metadata:
  name: default-server-secret
  namespace: nginx-ingress
type: Opaque
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN2akNDQWFZQ0NRREFPRjl0THNhWFhEQU5CZ2txaGtpRzl3MEJBUXNGQURBaE1SOHdIUVlEVlFRRERCWk8KUjBsT1dFbHVaM0psYzNORGIyNTBjbTlzYkdWeU1CNFhEVEU0TURreE1qRTRNRE16TlZvWERUSXpNRGt4TVRFNApNRE16TlZvd0lURWZNQjBHQTFVRUF3d1dUa2RKVGxoSmJtZHlaWE56UTI5dWRISnZiR3hsY2pDQ0FTSXdEUVlKCktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQUwvN2hIUEtFWGRMdjNyaUM3QlBrMTNpWkt5eTlyQ08KR2xZUXYyK2EzUDF0azIrS3YwVGF5aGRCbDRrcnNUcTZzZm8vWUk1Y2Vhbkw4WGM3U1pyQkVRYm9EN2REbWs1Qgo4eDZLS2xHWU5IWlg0Rm5UZ0VPaStlM2ptTFFxRlBSY1kzVnNPazFFeUZBL0JnWlJVbkNHZUtGeERSN0tQdGhyCmtqSXVuektURXUyaDU4Tlp0S21ScUJHdDEwcTNRYzhZT3ExM2FnbmovUWRjc0ZYYTJnMjB1K1lYZDdoZ3krZksKWk4vVUkxQUQ0YzZyM1lma1ZWUmVHd1lxQVp1WXN2V0RKbW1GNWRwdEMzN011cDBPRUxVTExSakZJOTZXNXIwSAo1TmdPc25NWFJNV1hYVlpiNWRxT3R0SmRtS3FhZ25TZ1JQQVpQN2MwQjFQU2FqYzZjNGZRVXpNQ0F3RUFBVEFOCkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQWpLb2tRdGRPcEsrTzhibWVPc3lySmdJSXJycVFVY2ZOUitjb0hZVUoKdGhrYnhITFMzR3VBTWI5dm15VExPY2xxeC9aYzJPblEwMEJCLzlTb0swcitFZ1U2UlVrRWtWcitTTFA3NTdUWgozZWI4dmdPdEduMS9ienM3bzNBaS9kclkrcUI5Q2k1S3lPc3FHTG1US2xFaUtOYkcyR1ZyTWxjS0ZYQU80YTY3Cklnc1hzYktNbTQwV1U3cG9mcGltU1ZmaXFSdkV5YmN3N0NYODF6cFErUyt1eHRYK2VBZ3V0NHh3VlI5d2IyVXYKelhuZk9HbWhWNThDd1dIQnNKa0kxNXhaa2VUWXdSN0diaEFMSkZUUkk3dkhvQXprTWIzbjAxQjQyWjNrN3RXNQpJUDFmTlpIOFUvOWxiUHNoT21FRFZkdjF5ZytVRVJxbStGSis2R0oxeFJGcGZnPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBdi91RWM4b1JkMHUvZXVJTHNFK1RYZUprckxMMnNJNGFWaEMvYjVyYy9XMlRiNHEvClJOcktGMEdYaVN1eE9ycXgrajlnamx4NXFjdnhkenRKbXNFUkJ1Z1B0ME9hVGtIekhvb3FVWmcwZGxmZ1dkT0EKUTZMNTdlT1l0Q29VOUZ4amRXdzZUVVRJVUQ4R0JsRlNjSVo0b1hFTkhzbysyR3VTTWk2Zk1wTVM3YUhudzFtMApxWkdvRWEzWFNyZEJ6eGc2clhkcUNlUDlCMXl3VmRyYURiUzc1aGQzdUdETDU4cGszOVFqVUFQaHpxdmRoK1JWClZGNGJCaW9CbTVpeTlZTW1hWVhsMm0wTGZzeTZuUTRRdFFzdEdNVWozcGJtdlFmazJBNnljeGRFeFpkZFZsdmwKMm82MjBsMllxcHFDZEtCRThCay90elFIVTlKcU56cHpoOUJUTXdJREFRQUJBb0lCQVFDZklHbXowOHhRVmorNwpLZnZJUXQwQ0YzR2MxNld6eDhVNml4MHg4Mm15d1kxUUNlL3BzWE9LZlRxT1h1SENyUlp5TnUvZ2IvUUQ4bUFOCmxOMjRZTWl0TWRJODg5TEZoTkp3QU5OODJDeTczckM5bzVvUDlkazAvYzRIbjAzSkVYNzZ5QjgzQm9rR1FvYksKMjhMNk0rdHUzUmFqNjd6Vmc2d2szaEhrU0pXSzBwV1YrSjdrUkRWYmhDYUZhNk5nMUZNRWxhTlozVDhhUUtyQgpDUDNDeEFTdjYxWTk5TEI4KzNXWVFIK3NYaTVGM01pYVNBZ1BkQUk3WEh1dXFET1lvMU5PL0JoSGt1aVg2QnRtCnorNTZud2pZMy8yUytSRmNBc3JMTnIwMDJZZi9oY0IraVlDNzVWYmcydVd6WTY3TWdOTGQ5VW9RU3BDRkYrVm4KM0cyUnhybnhBb0dCQU40U3M0ZVlPU2huMVpQQjdhTUZsY0k2RHR2S2ErTGZTTXFyY2pOZjJlSEpZNnhubmxKdgpGenpGL2RiVWVTbWxSekR0WkdlcXZXaHFISy9iTjIyeWJhOU1WMDlRQ0JFTk5jNmtWajJTVHpUWkJVbEx4QzYrCk93Z0wyZHhKendWelU0VC84ajdHalRUN05BZVpFS2FvRHFyRG5BYWkyaW5oZU1JVWZHRXFGKzJyQW9HQkFOMVAKK0tZL0lsS3RWRzRKSklQNzBjUis3RmpyeXJpY05iWCtQVzUvOXFHaWxnY2grZ3l4b25BWlBpd2NpeDN3QVpGdwpaZC96ZFB2aTBkWEppc1BSZjRMazg5b2pCUmpiRmRmc2l5UmJYbyt3TFU4NUhRU2NGMnN5aUFPaTVBRHdVU0FkCm45YWFweUNweEFkREtERHdObit3ZFhtaTZ0OHRpSFRkK3RoVDhkaVpBb0dCQUt6Wis1bG9OOTBtYlF4VVh5YUwKMjFSUm9tMGJjcndsTmVCaWNFSmlzaEhYa2xpSVVxZ3hSZklNM2hhUVRUcklKZENFaHFsV01aV0xPb2I2NTNyZgo3aFlMSXM1ZUtka3o0aFRVdnpldm9TMHVXcm9CV2xOVHlGanIrSWhKZnZUc0hpOGdsU3FkbXgySkJhZUFVWUNXCndNdlQ4NmNLclNyNkQrZG8wS05FZzFsL0FvR0FlMkFVdHVFbFNqLzBmRzgrV3hHc1RFV1JqclRNUzRSUjhRWXQKeXdjdFA4aDZxTGxKUTRCWGxQU05rMXZLTmtOUkxIb2pZT2pCQTViYjhibXNVU1BlV09NNENoaFJ4QnlHbmR2eAphYkJDRkFwY0IvbEg4d1R0alVZYlN5T294ZGt5OEp0ek90ajJhS0FiZHd6NlArWDZDODhjZmxYVFo5MWpYL3RMCjF3TmRKS2tDZ1lCbyt0UzB5TzJ2SWFmK2UwSkN5TGhzVDQ5cTN3Zis2QWVqWGx2WDJ1VnRYejN5QTZnbXo5aCsKcDNlK2JMRUxwb3B0WFhNdUFRR0xhUkcrYlNNcjR5dERYbE5ZSndUeThXczNKY3dlSTdqZVp2b0ZpbmNvVlVIMwphdmxoTUVCRGYxSjltSDB5cDBwWUNaS2ROdHNvZEZtQktzVEtQMjJhTmtsVVhCS3gyZzR6cFE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=

---
kind: ConfigMap
apiVersion: v1
metadata:
  name: nginx-config
  namespace: nginx-ingress
data:
  server-names-hash-bucket-size: "1024"


---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1beta1
metadata:
  name: nginx-ingress
rules:
- apiGroups:
  - ""
  resources:
  - services
  - endpoints
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
  - update
  - create
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - list
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
  - patch
- apiGroups:
  - extensions
  resources:
  - ingresses
  verbs:
  - list
  - watch
  - get
- apiGroups:
  - "extensions"
  resources:
  - ingresses/status
  verbs:
  - update
- apiGroups:
  - k8s.nginx.org
  resources:
  - virtualservers
  - virtualserverroutes
  verbs:
  - list
  - watch
  - get

---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1beta1
metadata:
  name: nginx-ingress
subjects:
- kind: ServiceAccount
  name: nginx-ingress
  namespace: nginx-ingress
roleRef:
  kind: ClusterRole
  name: nginx-ingress
  apiGroup: rbac.authorization.k8s.io

---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: nginx-ingress
  namespace: nginx-ingress
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "9113"
spec:
  selector:
    matchLabels:
      app: nginx-ingress
  template:
    metadata:
      labels:
        app: nginx-ingress
    spec:
      serviceAccountName: nginx-ingress
      containers:
      - image: nginx/nginx-ingress:1.5.5
        name: nginx-ingress
        ports:
        - name: http
          containerPort: 80
          hostPort: 80
        - name: https
          containerPort: 443
          hostPort: 443
        - name: prometheus
          containerPort: 9113
        env:
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        args:
          - -nginx-configmaps=$(POD_NAMESPACE)/nginx-config
          - -default-server-tls-secret=$(POD_NAMESPACE)/default-server-secret
         #- -v=3 # Enables extensive logging. Useful for troubleshooting.
         #- -report-ingress-status
         #- -external-service=nginx-ingress
         #- -enable-leader-election
          - -enable-prometheus-metrics
         #- -enable-custom-resources

```
#### é…ç½®åŸŸåè§£æ

å°†åŸŸå `*.demo.yourdomain.com` è§£æåˆ° `demo-worker-a-2` çš„ IP åœ°å€ z.z.z.z ï¼ˆä¹Ÿå¯ä»¥æ˜¯ demo-worker-a-1 çš„åœ°å€ y.y.y.yï¼‰

#### éªŒè¯é…ç½®
åœ¨æµè§ˆå™¨è®¿é—® `a.demo.yourdomain.com`ï¼Œå°†å¾—åˆ° 404 NotFound é”™è¯¯é¡µé¢

> #### æç¤º
> è®¸å¤šåˆå­¦è€…åœ¨å®‰è£… Ingress Controller æ—¶ä¼šç¢°åˆ°é—®é¢˜ï¼Œè¯·ä¸è¦ç°å¿ƒï¼Œå¯æš‚æ—¶è·³è¿‡ å®‰è£… Ingress Controller è¿™ä¸ªéƒ¨åˆ†ï¼Œç­‰æ‚¨å­¦å®Œ www.kuboard.cn ä¸Š [Kubernetes å…¥é—¨](https://kuboard.cn/learning/k8s-basics/kubernetes-basics.html) ä»¥åŠ [é€šè¿‡äº’è”ç½‘è®¿é—®æ‚¨çš„åº”ç”¨ç¨‹åº](https://kuboard.cn/learning/k8s-intermediate/service/ingress.html) è¿™ä¸¤éƒ¨åˆ†å†…å®¹åï¼Œå†æ¥å›é¡¾ Ingress Controller çš„å®‰è£…ã€‚

> #### WARNING
> å¦‚æœæ‚¨æ‰“ç®—å°† Kubernetes ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œè¯·å‚è€ƒæ­¤æ–‡æ¡£ [Installing Ingress Controller](https://github.com/nginxinc/kubernetes-ingress/blob/v1.5.3/docs/installation.md)ï¼Œå®Œå–„ Ingress çš„é…ç½®



























 ---
