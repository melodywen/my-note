# 性能测试
> 参考文章：https://segmentfault.com/a/1190000040868502


## 1. 概述 
### 1.1 性能分析
在日常开发中，性能优化往往是一个长期的事情，在业务的不同阶段，会遇到各种各样的性能问题，迅速分析并定位程序的性能瓶颈，能让我们付出最小的努力，得到最大的回报。

### 1.2 代码开发上线步骤
1. 上线前
   - 压测：我们通过压测可以获知系统的性能，例如每秒能处理的请求数，平均响应时间，错误率等指标。这样，我们对自己服务的性能算是有个底。
   - 问题：但是压测是线下的模拟流量，如果到了线上呢？会遇到高并发、大流量，不靠谱的上下游，突发的尖峰流量等等场景，这些都是不可预知的。

2. 上线后
   - 线上突然大量报警，接口超时，错误数增加
   - 终极解决方案：**`看日志`、`看监控`；`使用性能分析工具`分析程序的性能，找到瓶颈**
   - 临时解决方案：**首先要`降级`、`限流`、`回滚`，先止损**

3. 总结
   - 性能分析很重要，尤其是要统计好性能数据，出问题了，可以随时拿出来看。
  
***根据上面内容引出了性能分析，性能分析主要关注 `CPU`、`内存`、`磁盘 IO`、`网络`这些指标***。
> profiling 是指在程序执行过程中，收集能够反映程序执行状态的数据。

**一般常规内容：**
- `cpu`：程序对cpu的使用情况 - 使用时长，占比等
- `内存`：程序对cpu的使用情况 - 使用时长，占比，内存泄露等。如果在往里分，程序堆、栈使用情况
- `I/O`：IO的使用情况 - 哪个程序IO占用时间比较长

**golang 程序中：**
- `goroutine`：go的协程使用情况，调用链的情况
- `goroutine leak`：goroutine泄露检查
- `go dead lock`：死锁的检测分析
- `data race detector`：数据竞争分析，其实也与死锁分析有关


### 1.3 golang 性能调试优化方法：

- Benchmark：**基准测试**，对特定代码的运行时间和内存信息等进行测试
- Profiling：**程序分析**，程序的运行画像，在程序执行期间，通过采样收集的数据对程序进行分析
- Trace：**跟踪**，在程序执行期间，通过采集发生的事件数据对程序进行分析

> profiling 和 trace 有啥区别？
> profiling 分析没有时间线，trace 分析有时间线。

**在 golang 中，应用方法的工具呢？**

这里介绍 pprof 这个 golang 工具，它可以帮助我们调试优化程序。

























-----